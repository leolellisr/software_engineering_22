<html>
<head>
    <link rel="stylesheet" href="css/style.css"></link>
</head>
    <style>
        header {
            background-color:hsla(215, 50%, 23%, 1);
            border-style: solid;
            border-width: 5px;
            color: hsla(215, 50%, 23%, 1);
            font-family: 'Calibri';
        }
        h1 {
            color: hsla(105, 55%, 96%, 1);
            text-align: center;
        }
        p {
            color: hsla(105, 55%, 96%, 1);
            text-align: right;
        }
        span {
            color: hsla(105, 55%, 96%, 1);
            float: left;
        }
        #quit {
            position: absolute;
            left: 15%;
            bottom: 3%;
            background: hsla(215, 50%, 23%, 1);
            color: hsla(105, 55%, 96%, 1);
        }
        #butt {
            position: static;
            left: 39.65%;
            background: rgb(40, 240, 66);
            color: rgb(19, 20, 19);
        }
        #but {
            position: static;
            left: 39.65%;
            background: rgb(233, 247, 48);
            color: hsla(19, 20, 19);
        }


    </style>
    <header>
        <h1>Sistema do Cozinheiro</h1>
        <p>
            Data: {{}}  Hora: {{}}
            <span>Nome: {{}}  Cargo: {{}}  </span>
        </p>
    </header>
    <body>
        <div class= "container">
            <div id = "app">
                <div class="Consulta">
                    <h2 id="insercao_title"> Pedidos: </h2>
                    <form @submit.prevent="clear">
                        <div id="pedido">  
                            <table margin="auto"; id="data">
                                <tr v-for = "order in payload.pedidos">
                                    <td>{{order.item}}</td>
                                    <td>{{order.status}}</td>
                                    <td><button v-on:click="doGet()" >Consulta</button> &nbsp;</td>
                                    <td><button id="but" v-on:Click='doStatusAndamento()'>Em Andamento</button></td>
                                    <td><button id="butt" v-on:Click='doStatusPronto()'>Pronto</button></td>
                                </tr>
                            </table> 
                        </div>
                    </form>
    
                </div>
                <div class="Pedido">
                    <div class="tableFixHead">
                        <h2 id="insercao_title"> Resumo </h2>
                        <form @submit.prevent="clear">
                            <table  id="data">
                                <thead>
                                <tr>   
                                    <th> Itens </th>
                                    <th> Quantidade </th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for = "order in payload.pedidos">
                                        <td>{{order.item}}</td>
                                        <td>{{order.quantidade}}</td>
                                </tr>
                                </tbody>
                            </table>
                        </form>
                    </div>
                </div>
                <div id = "app">
                    <div class="Insercao">
                        <form @submit.prevent="clear" action = "/pedidos">
                            <h2 id="insercao_title"> Inserção e Update </h2>
                            <div id="pedido">
                                <label>Pedido:</label>  
                                <input id="pedido_input" type="text" name = "pedido" v-model = "orders.pedido">  <br> <br>
                            </div>
                            <div id = "item">
                                <label>Item: </label> 
                                <input id="item_input" type="text" name = "item" v-model = "orders.item"> <br> <br>
                            </div>
                            <div id = "quantidade">
                                <label> Quantidade: </label>
                                <input id="quantidade_input" type="text" name = "quantidade" v-model = "orders.quantidade"> <br> <br>
                            </div>
                            <div id = "status">
                                <label> Status: </label>
                                <input id="status_input" type="text" name = "status" v-model = "orders.status"> <br> <br>
                            </div>
                        </form>
        
                        <button v-on:click="doPost()">Insert</button> &nbsp;
                        <button v-on:click="doPut()">Update</button> &nbsp;
                    </div>
                </div>
        
                <br><br><button id="Quit" v-on:click="doEntraCozMain()"> Quit</button>&nbsp;
            </div>
        </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.15.2/axios.js"></script>
    <script>
       
        
        var app = new Vue({
            el: '#app',
            data: {
                payload: '',
                recurso: '/pedidos/',
                itens:'',
                orders:{
                    pedido: '',
                    item: '',
                    quantidade: '',
                    status: '',
                },
                get:{
                    pedido: ''
                }

            },
            methods: {
                doGet: async function () {
                    var url = app.recurso + app.get.pedido;
                    var data = app.get.pedido;
                    var request = axios({"method": "get","url": url});
                     try {
                       response = await request
                    } catch (error) {
                         response = {"data": { "resultado": " URL inválida" }, "status": 404, "statusText": "Error"}
                    } 
                    app.payload = response.data
                    app.codigo = response.status + " "+ response.statusText

                    app.orders.pedido = response.data.pedidos[0].pedido;
                    app.orders.item = response.data.pedidos[0].item;
                    app.orders.quantidade = response.data.pedidos[0].quantidade;
                    app.orders.status = response.data.pedidos[0].status;
             

                },

                // POST
                doPost: async function () {
                    var url = app.recurso;
                    var data = app.orders;
                    var request = axios({
                        "method": "post",
                        "url": url,
                        "headers": { "Content-Type": "application/json" },
                        "data": data});
                    try {
                        response = await request;
                        app3.doList();
                    } catch (error) {
                        response = response = {"data": { "resultado": " URL inválida" }, "status": 404, "statusText": "Error"}
                        return;
                    }  
                    app.payload = response.data
                    app.codigo = response.status + " "+ response.statusText 
                          
                },
  
    // PUT
    doPut: async function() {
       var url = app.recurso + app.orders.pedido;
       var data = {"status": "Em Andamento"};
       var request = axios({
                   "method": "put",
                   "url": url,
		            "headers": { "Content-Type": "application/json" },		   
                   "data": data});
        try {
        response = await request
       } catch (error) {
         response = {"data": { "resultado": " URL inválida"  }, "status": 400, "statusText": "Error"}
       }  
        app.payload = response.data
        app.codigo = response.status + " "+ response.statusText
        
    }
  

            }
        });
		var app3 = new Vue({
            el: '#list',
            data: { 
            itens: '',
            mensagem: ''
             },

             methods: {
                 doList: async function(){
                     var request = axios({
                        "method": "get",
                        "url": "/pedidos/",
                        "data": ""
                     });
                     try{
                         var response = await request;
                         this.itens = response.data.coms.itens;
                     }
                     catch (error){
                         app3.mensagem = "Usuário não autenticado";
                         return;
                     }
                 }
             }
        });
        var app2 = new Vue({
            el: '#quit',
            methods: {
                doEntraCozMain: async function(){
                    window.location.replace("/page/coz-main", "Cozinheiro Main", "_self");
                }
            }
        });
        
    </script>
</body>
</html>